## 9.4. 바운디드 컨텍스트 간 통합

<br>

### 예시 

온라인 쇼핑 사이트에서 카탈로그 하위 도메인에 추천 시스템을 도입하기로 했다고 치자.

이렇게 되면 카탈로그 하위 도메인에는 기존 카탈로그를 위한 바운디드 컨텍스트와 추천 기능을 위한 바운디드 컨텍스트가 생김.

두 팀이 관련된 바운디드 컨텍스트를 개발하면 자연스럽게 두 바운디드 컨텍스트 간 통합이 발생함.

통합이 필요한 기능은 다음과 같음.

- 사용자가 제품 상세 페이지를 볼 떄, 보고 있는 상품과 유사한 상품 목록을 하단에 보여줌.

사용자가 카탈로그 바운디드 컨텍스트에 추천 제품 목록을 요청하면 카탈로그 바운디드 컨텍스트는 추천 바운디드 컨텍스트로부터 추천 정보를 읽어와 추천 제품 목록을 제공함.

> 이때 카탈로그 컨텍스트와 추천 컨텍스트의 도메인 모델은 서로 다름.
> 카탈로그는 제품을 중심으로 도메인 모델을 구현하지만, 추천은 추천 연산을 위한 모델을 구현함.

카탈로그 시스템은 추천 시스템으로부터 추천 데이터를 받아오지만, 카탈로그 시스템에서는 추천의 도메인 모델을 사용하기보다는 카탈로그 도메인 모델을 사용해서 추천 상품을 표현해야 함.

즉, 다음과 같이 카탈로그의 모델을 기반으로 하는 도메인 서비스를 이용해서 상품 추천 기능을 표현해야 함.

```java
public interface ProductRecommendationService {
    List<Product> getRecommendationsOf(ProductId id);
}
```

도메인 서비스를 구현한 클래스는 인프라스트럭처 영역에 위치함.
이 클래스는 외부 시스템과의 연동을 처리하고 외부 시스템의 모델과 현재 도메인 모델 간의 변환을 책임짐.

![](https://velog.velcdn.com/images/mo-zza/post/68933daf-cd72-49d7-a99b-64d3d1c1d6c0/image.png)

<br>

### REST API

RecSystemClient 는 외부 추천 시스템이 제공하는 REST API 를 이용해서 특정 상품을 위한 추천 상품 목록을 로딩함.

이 REST API 가 제공하는 데이터는 추천 시스템의 모델을 기반으로 하고 있기 때문에, API 응답은 카탈로그 도메인 모델과 일치하지 않는 데이터를 제공할 것임.

그래서 REST API 로 부터 데이터를 읽어와 카탈로그 도메인에 맞는 상품 모델로 변환함.

REST API 를 호출하는 것은 두 바운디드 컨텍스트를 직접 통합하는 방법임.

<br>

### 메시지 큐

메시지 큐를 사용해서 간접적으로 도메인 컨텍스트를 통합함.

추천 시스템은 사용자가 조회한 상품 이력이나 구매 이력과 같은 사용자 활동 이력을 필요로 하는데, 이 내역을 전달할 때 메시지 큐를 사용함.

![](https://velog.velcdn.com/images/mo-zza/post/b9c531b1-4136-46ea-829e-b6b2eff3c00b/image.png)

메시지 큐는 **비동기**로 메시지를 처리하기 때문에 카탈로그 바운디드 컨텍스트는 메시지를 큐에 추가한 뒤 추천 바운디드 컨테그트가 메시지를 처리할 때까지 기다리지 않고 바로 이어서 자신의 처리를 계속함.

추천 바운디드 컨텍스트는 큐에서 이력 메시지를 읽어와 추천을 계산하는 데 사용할 것임.
이는 두 바운디드 컨텍스트가 사용할 메시지의 **데이터 구조를 맞춰야 함**을 의미함.

어떤 도메인 관점에서 모델을 사용하느냐에 따라 두 바운디드 컨텍스트의 구현 코드가 달라지게 됨.

두 바운디드 컨텍스트를 개발하는 팀은 메시징 큐에 담을 데이터의 구조를 협의하게 되는데 그 큐를 누가 제공하느냐에 다라 데이터 구조가 결정됨.

큐를 추천 시스템에서 제공할 경우 큐를 통해 메시지를 추천 시스템에 전달하는 방식이 됨.
이 경우 큐로 인해 비동기로 추천 시스템에 데이터를 전달하는 것을 제외하면 추천 시스템이 제공하는 REST API 를 사용해서 데이터를 전달하는 것과 차이가 없음.