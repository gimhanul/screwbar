## 7.1. 여러 애그리거트가 필요한 기능

한 애그리거트로 기능을 구현할 수 없을 때가 있음.

<br>

### 예시: 결제 금액 계산 로직

실제 결제 금액을 계산할 때는 다음과 같은 내용이 필요함.

- 상품 애그리거트: 구매하는 상품의 가격이 필요함. 상품에 따라 배송비가 추가되기도 함.
- 주문 애그리거트: 상품별로 구매 개수가 필요함.
- 할인 쿠폰 애그리거트: 쿠폰별로 지정한 할인 금액이나 비율에 따라 주문 총 금액을 할인 함. 할인 쿠폰을 조건에 따라 중복 사용할 수 있다거나 지정한 카테고리의 상품에 적용할 수 있다는 제약 조건이 있다면 할인 계산이 복잡해짐.
- 회원 애그리거트: 회원 등급에 따라 추가 할인이 가능함.

이 상황에서 실제 결제 금액을 계산해야 하는 주체는 어떤 애그리거트일까?

생각해 볼 수 있는 방법은 주문 애그리거트가 필요한 데이터를 모두 가지도록 한 뒤 금액 계산 책임을 주문 애그리거트에 할당하는 것임.

여기서 결제 금액 계산 로직이 주문 애그리거트의 책임이 맞을까?

특별 감사 세일로 전 품목에 대해 한 달간 2% 추가 할인을 하기로 했다고 해보자. 이 할인 정책은 주문 애그리거트가 갖고 있는 구성요소와 관련이 전혀 없음에도 불구하고 결제 금액 계산 책임이 주문 애그리거트에 있다는 이유로 주문 애그리거트의 코드를 수정해야 함.

<br>

### 결론

이렇게 한 애그리거트에 넣기 애매한 도메인 기능을 **억지로 특정 애그리거트에 구현하면 안 되**고,
**도메인 기능을 별도 서비스로 구현**하는 게 좋음.

억지로 구현하면 애그리거트는 자신의 책임 범위를 넘어서는 기능을 구현하기 때문에

- 코드가 길어짐.
- 외부에 대한 의존이 높아짐.
- 코드를 복잡하게 만듦.
- 수정을 어렵게 만듦.
- 애그리거트의 범위를 넘어서는 도메인 개념이 애그리거트에 숨어들어, 명시적으로 드러나지 않게 됨.