## 1.5. ë„ë©”ì¸ ëª¨ë¸ ë„ì¶œ

### ì£¼ë¬¸ ë„ë©”ì¸ ëª¨ë¸ ë„ì¶œ ì˜ˆì‹œ

ë„ë©”ì¸ ëª¨ë¸ë§ì„ í•  ë•Œ ê¸°ë³¸ì´ ë˜ëŠ” ì‘ì—…ì€ **í•µì‹¬ êµ¬ì„±ìš”ì†Œ, ê·œì¹™, ê¸°ëŠ¥ì„ ì°¾ëŠ” ê²ƒ**ì„.

ê·¸ë¦¬ê³  ì´ ê³¼ì •ì€ ìš”êµ¬ì‚¬í•­ì—ì„œ ì¶œë°œí•¨.

#### ìš”êµ¬ì‚¬í•­

- ìµœì†Œ í•œ ì¢…ë¥˜ ì´ìƒì˜ ìƒí’ˆì„ ì£¼ë¬¸í•´ì•¼ í•¨.
- í•œ ìƒí’ˆì„ í•œ ê°œ ì´ìƒ ì£¼ë¬¸í•  ìˆ˜ ìˆìŒ.
- ì´ ì£¼ë¬¸ ê¸ˆì•¡ì€ ê° ìƒí’ˆì˜ êµ¬ë§¤ ê°€ê²© í•©ì„ ëª¨ë‘ ë”í•œ ê¸ˆì•¡ì„.
- ê° ìƒí’ˆì˜ êµ¬ë§¤ ê°€ê²© í•©ì€ ìƒí’ˆ ê°€ê²©ì— êµ¬ë§¤ ê°œìˆ˜ë¥¼ ê³±í•œ ê°’ì„.
- ì£¼ë¬¸í•  ë•Œ ë°°ì†¡ì§€ ì •ë³´ë¥¼ ë°˜ë“œì‹œ ì§€ì •í•´ì•¼ í•¨.
- ë°°ì†¡ì§€ ì •ë³´ëŠ” ë°›ëŠ” ì‚¬ëŒ ì´ë¦„, ì „í™”ë²ˆí˜¸, ì£¼ì†Œë¡œ êµ¬ì„±ë¨.
- ì¶œê³ ë¥¼ í•˜ë©´ ë°°ì†¡ì§€ë¥¼ ë³€ê²½í•  ìˆ˜ ì—†ìŒ.
- ì¶œê³  ì „ì— ì£¼ë¬¸ì„ ì·¨ì†Œí•  ìˆ˜ ìˆìŒ.
- ê³ ê°ì´ ê²°ì œë¥¼ ì™„ë£Œí•˜ê¸° ì „ì—ëŠ” ìƒí’ˆì„ ì¤€ë¹„í•˜ì§€ ì•ŠìŒ.

#### ì£¼ë¬¸

- í•„ìš”í•œ ê¸°ëŠ¥
    - ì¶œê³  ìƒíƒœë¡œ ë³€ê²½í•˜ê¸°
    - ë°°ì†¡ì§€ ì •ë³´ ë³€ê²½í•˜ê¸°
    - ì£¼ë¬¸ ì·¨ì†Œí•˜ê¸°
    - ê²°ì œ ì™„ë£Œí•˜ê¸°

```java
public class Order {
    public void changeShipped() {...}
    public void changeShippingInfo(ShippingInfo newShipping) {...}
    public void cancel() {...}
    pblic void completePayment() {...}
}
```

#### ì£¼ë¬¸ í•­ëª©

- ê´€ë ¨ ìš”êµ¬ì‚¬í•­
    - í•œ ìƒí’ˆì„ í•œ ê°œ ì´ìƒ ì£¼ë¬¸í•  ìˆ˜ ìˆìŒ.
    - ê° ìƒí’ˆì˜ êµ¬ë§¤ ê°€ê²© í•©ì€ ìƒí’ˆ ê°€ê²©ì— êµ¬ë§¤ ê°œìˆ˜ë¥¼ ë”í•œ ê°’ì„.
- í•„ìš”í•œ í•„ë“œ
  - ì£¼ë¬¸í•  ìƒí’ˆ
  - ìƒí’ˆì˜ ê°€ê²©
  - êµ¬ë§¤ ê°œìˆ˜
- ê¸°ëŠ¥
  - ê° êµ¬ë§¤ í•­ëª©ì˜ êµ¬ë§¤ ê°€ê²© ì œê³µ

```java
public class OrderLine {
    private Product product;
    private int price;
    private int quantity;
    private int amounts;
    
    private int calculateAmounts() {
        return price * quantity;
    }
    
    public OrderLine(Product product, int price, int quantity) {
        this.product = product;
        this.price = price;
        this.quantity = quantity;
        this.amounts = calculateAmounts();
    }
    
    // getter
}
```

#### ì£¼ë¬¸ê³¼ ì£¼ë¬¸í•­ëª©ì˜ ê´€ê³„

- ê´€ë ¨ ìš”êµ¬ì‚¬í•­
  - ìµœì†Œ í•œ ì¢…ë¥˜ ì´ìƒì˜ ìƒí’ˆì„ ì£¼ë¬¸í•´ì•¼ í•¨.
  - ì´ ì£¼ë¬¸ ê¸ˆì•¡ì€ ê° ìƒí’ˆì˜ êµ¬ë§¤ ê°€ê²© í•©ì„ ëª¨ë‘ ë”í•œ ê¸ˆì•¡ì„.
- ê´€ê³„
  - í•œ ì¢…ë¥˜ ì´ìƒì˜ ìƒí’ˆì„ ì£¼ë¬¸í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì£¼ë¬¸ì€ ìµœì†Œ í•œ ê°œ ì´ìƒì˜ ì£¼ë¬¸ í•­ëª©ì„ í¬í•¨í•´ì•¼ í•¨.

```java
public class Order {
    private List<OrerLine> orderLines;
    private Money totalAmounts;
    
    public Order(List<OrderLine> orderLines) {
        setOrderLines(orderLines);
    }
    
    private void setOrderLines(List<OrderLine> orderLines) {
        verifyAtLeastOneOrMoreOrderLines(orderLines);
        this.orderLines = orderLines;
        calculateTotalAmounts();
    }
    
    private void verifyAtLeastOneOrMoreOrderLines(List<OrderLine> orderLines) {
        if (orderLines == null || orderLines.isEmpty()) {
            throw new IllegalArgumentException("no OrderLine");
        }
    }
    
    private void calculateTotalAmounts() {
        int sum = orderLines.stream()
                            .mapToInt(x -> x.getAmounts())
                            .sum();
                            
        this.totalAmounts = new Money(sum);
    }
}
```

#### ë°°ì†¡ì§€ ì •ë³´

- í•„ìš”í•œ í•„ë“œ
  - ì´ë¦„
  - ì „í™”ë²ˆí˜¸
  - ì£¼ì†Œ

```java
public class ShippingInfo {
    private String receiverName;
    private String receiverPhoneNumber;
    private String shippingAddress1;
    private String shippingAddress2;
    private String shippingZipcode;
    
    // constructor, getter ...
}
```

#### ì£¼ë¬¸ê³¼ ë°°ì†¡ì§€ ì •ë³´ì˜ ê´€ê³„

- ê´€ë ¨ ìš”êµ¬ì‚¬í•­
  - ì£¼ë¬¸í•  ë•Œ ë°°ì†¡ì§€ ì •ë³´ë¥¼ ë°˜ë“œì‹œ ì§€ì •í•´ì•¼ í•œë‹¤.
    > ğŸ‘‰ ì£¼ë¬¸ì„ ìƒì„±í•  ë•Œ ì£¼ë¬¸ í•­ëª©ì˜ ëª©ë¡ ë¿ë§Œ ì•„ë‹ˆë¼ ë°°ì†¡ì§€ ì •ë³´ë„ í•¨ê»˜ ì „ë‹¬í•´ì•¼ í•¨. â†’ ìƒì„±ìì— ë°˜ì˜

```java
public class Order {
    private List<OrderLine> orderLines;
    private ShippingInfo shippingInfo;
    
    ...
    
    public Order(List<OrderLine> orderLines, ShippingInfo shippingInfo) {
        setOrderLines(orderLines);
        setShippingInfo(shippingInfo);
    }
    
    private void setShippingInfo(ShippingInfo shippingInfo) {
        // 'ë°°ì†¡ì§€ ì •ë³´ í•„ìˆ˜' ë„ë©”ì¸ ê·œì¹™ êµ¬í˜„
        if (shippingInfo == null)
            throw new IllegalArgumentException("no ShippingInfo");
        
        this.shippingInfo = shippingInfo;
    }
}
```

#### ì£¼ë¬¸ ìƒíƒœ

ë„ë©”ì¸ì„ êµ¬í˜„í•˜ë‹¤ ë³´ë©´ íŠ¹ì • ì¡°ê±´ì´ë‚˜ ìƒíƒœì— ë”°ë¼ ì œì•½ì´ë‚˜ ê·œì¹™ì´ ë‹¬ë¦¬ ì ìš©ë˜ëŠ” ê²½ìš°ê°€ ë§ìŒ.

- ì¶œê³ ë¥¼ í•˜ë©´ ë°°ì†¡ì§€ ì •ë³´ë¥¼ ë³€ê²½í•  ìˆ˜ ì—†ìŒ.
- ì¶œê³  ì „ì— ì£¼ë¬¸ì„ ì·¨ì†Œí•  ìˆ˜ ìˆìŒ.
- ê³ ê°ì´ ê²°ì œë¥¼ ì™„ë£Œí•˜ê¸° ì „ì—ëŠ” ìƒí’ˆì„ ì¤€ë¹„í•˜ì§€ ì•ŠìŒ.

```java
public enum OrderState {
    PAYMENT_WAITING, PREPARING, SHIPPED, DELIVERING, DELIVERY_COMPLETED,
    CANCELED;
}
```

#### ì œì•½ ê·œì¹™ êµ¬í˜„

```java
public class Order {
    private OrderState state;
    
    public void changeShippingInfo(ShippingInfo newShippingInfo) {
        verifyNotYetShipped();
        setShippingInfo(newShippingInfo);
    }
    
    public void cancel() {
        verifyNotYetShipped();
        this.state = OrderState.CANCELED;
    }
    
    private void verifyNotYetShipped() {
        if (state != OrderState.PAYMENT_WAITING && state != OrderState.PREPARING)
            throw new IllegalStateException("already shipped");
    }
}
```
