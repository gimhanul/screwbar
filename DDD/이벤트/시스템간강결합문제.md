## 10.1. 시스템 간 강결합 문제

<br>

### 문제점

쇼핑몰에서 구매를 취소하려면 환불을 처리해야 함. 

보통 결제 시스템은 외부에 존재하므로 해당 도메인 서비스는 결제 시스템이 제공하는 환불 서비스를 호출함.

이때 여러 문제가 발생할 수 있음.

1. 외부 서비스가 정상이 아닐 경우 트랜잭션 처리가 애매함.
   - 환불 기능을 실행하는 과정에서 익셉션이 발생하면 롤백해야 할까 커밋해야 할까?
   - 반드시 트랜잭션을 롤백해야 하는 것은 아님.
   - 주문은 취소 상태로 변경하고 나중에 다시 시도하는 방식으로도 처리할 수 있음.
2. 성능
   - 환불을 처리하는 외부 시스템의 응답 시간이 길어지면 대기 시간도 길어짐.
   - 즉, 외부 서비스 성능에 직접적인 영향을 받게 됨.
3. 설계상 문제
   - 주문 로직과 결제 로직이 섞일 수 있음.
   - 이는 환불 기능이 바뀌면 Order 도 영향을 받게 된다는 것을 의미함.
4. 기능을 추가할 때
   - 주문을 취소한 뒤 환불뿐만 아니라 취소했다는 내용을 통지해야 한다면?
   - 환불 도메인 서비스와 동일하게 파라미터로 통지 서비스를 받도록 구현하면 로직이 섞이는 문제가 더 커지고 트랜잭션 처리가 더 복잡해짐.
   
<br>

### 강결합 `high coupling`

위의 문제점들이 발생하는 이유는 주문 바운디드 컨텍스트와 결제 바운디드 컨텍스트 간의 강결합 때문임.

이런 강한 결합을 없앨 수 있는 방법은 바로 **이벤트**를 사용하는 것임.

특히, 비동기 이벤트를 사요앟면 두 시스템 간의 결합을 크게 낮출 수 있음.