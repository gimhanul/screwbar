## 6.3. 응용 서비스의 구현

응용 서비스는 표현 영역과 도메인 영역을 연결하는 매개체 역할을 하는데, 이는 디자인 패턴에서 `facade` 와 같은 역할을 함.

<br>

### 응용 서비스의 크기

응용 서비스는 보통 다음의 두 가지 방법 중 하나로 구현함.

- 한 응용 서비스 클래스에 도메인의 모든 기능 구현
  - 장점
    - 각 기능에서 동일 로직에 대한 코드 중복을 제거할 수 있음.
  - 단점
    - 서비스 클래스의 크기가 커짐.
    - 이는 연관성이 적은 코드가 한 클래스에 함께 위치할 가능성이 높아져 관련 없는 코드가 뒤섞여 코드를 이해하는 데 방해가 됨.
- 구분되는 기능별로 응용 서비스 클래스를 따로 구현
  - 장점
    - 코드 품질을 일정 수준으로 유지하는 데 도움이 됨.
    - 다른 기능을 구현한 코드에 영향을 받지 않음.
  - 단점
    - 클래스의 개수가 많아짐.
    - 동일한 코드를 중복해서 구현할 가능성이 높음.
    > 별도 클래스에 로직을 구현해서, 코드가 중복되는 것을 방지할 수 있음.

<br>

### 응용 서비스의 인터페이스와 클래스

인터페이스는 구현 클래스가 여러 개일 경우 필요함. 구현 클래스가 다수 존재하거나 런타임에 구현 객체를 교체해야 할 때 인터페이스를 유용하게 사용할 수 있음.

하지만 이런 경우는 드물음.

이런 이유로 인터페이스와 클래스를 따로 구현하면

- 소스 파일만 많아짐.
- 구현 클래스에 대한 간접 참조가 증가해서 전체 구조가 복잡해짐.

따라서 인터페이스가 명확하게 필요하기 전까지는 **응용 서비스에 대한 인터페이스를 작성하는 것이 좋은 선택이라고 볼 수 없음**.

> 테스트 주도 개발 `Test Driven Development : TDD` 를 즐겨 하고 표현 영역부터 개발을 시작한다면, 응용 서비스의 인터페이스를 작성하게 될 것임. 
하지만, Mockito 와 같은 테스트 도구는 클래스에 대해서도 테스트용 대역 객체를 만들 수 있기 때문에 응용 서비스에 대한 인퍼테이스가 없어도 표현 영역을 테스트할 수 있음.
이는 결과적으로 응용 서비스에 대한 인터페이스 필요성을 약화시킴.

<br>

### 메서드 파라미터

기능을 실행하는 데 필요한 값을 파라미터로 전달받아야 함. 이때, 다음 두 가지 방법이 있음.

- 필요한 각 값을 개별 파라미터로 전달받기
- 값 전달을 위해 별도 클래스를 만들어 전달받기

> 스프링 MVC 와 같은 웹 프레임워크는 웹 요청 파라미터를 자바 객체로 변환하는 기능을 제공하므로 요청 파라미터가 두 개 이상 존재하면 데이터 전달을 위한 별도 클래스를 사용하는 게 편리함.

<br>

### 값 리턴

표현 영역 코드는 응용 서비스가 리턴한 값을 사용해서 사용자에게 알맞은 결과를 보여줄 수 있게 됨.

이때 애그리거트 객체를 그대로 리턴하면 안 됨.

도메인의 로직 실행을 응용 서비스와 표현 영역 두 곳에서 할 수 있게 되기 때문임. 이는 기능 실행 로직을 두 영역에 분산시켜 코드의 응집도를 낮추는 원인이 됨.

즉, 응용 서비스는 **표현 영역에서 필요한 데이터만 리턴**하는 것이 기능 실행 로직의 응집도를 높이는 확실한 방법임.

<br>

### 표현 영역에 의존하지 않기

응용 서비스의 파라미터 타입을 결정할 때, 표현 영역과 관련된 타입을 사용하면 안 됨.

> 예를 들어, 표현 영역에 해당하는 `HttpServeltRequest` 나 `HttpSession` 을 응용 서비스에 파라미터로 전달하면 안 됨.

응용 서비스에서 표현 영역에 대한 의존이 발생하면

- 응용 서비스만 단독으로 테스트하기 어려워짐.
- 표현 영역의 구현이 변경되면 응용 서비스의 구현도 함께 변경해야 함.
- 응용 서ㅣ스가 표현 영역의 역할까지 대신하는 상황이 벌어질 수도 있음.

    → 응용 서비스에서 표현 영역의 상태를 변경해 버리면, 표현 영역의 코드만으로 표현 영역의 상태가 어떻게 변경되는지 추적하기 어려워짐. 즉, 표현 영역의 응집도가 깨짐. 결과적으로 코드 유지 보수 비용을 증가시킴.

위의 문제가 발생하지 않도록 하려면, 철저하게 **응용 서비스가 표현 영역의 기술을 사용하지 않도록 해야 함**.

이를 지키기 위한 가장 쉬운 방법이, 서비스 메서드의 파라미터와 리턴 타입으로 표현 영역의 구현 기술을 사용하지 않는 것임.

<br>

### 트랜잭션 처리

트랜잭션을 관리하는 것은 응용 서비스의 중요한 역할임.

스프링과 같은 프레임워크가 제공하는 트랜잭션 관리 기능을 이용하면 쉽게 트랜잭션을 처리할 수 있음.

```java
public class ChangePasswordService {
    
    @Transactional
    public void changePassword(ChangePasswordRequest request) {
        ...
    }
}
```

> 프레임워크가 제공하는 트랜잭션 기능을 적극 사용하는 것이 좋음. 프레임워크의 규칙만 따르면 간단한 설정만으로 트랜잭션을 보장할 수 있음.